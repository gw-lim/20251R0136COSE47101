import pandas as pd

# 1. 데이터 불러오기
df = pd.read_csv("자치구별+연령별+인구(추계인구)_2022.csv", encoding="utf-8", skiprows=2)

# 2. 필요한 열만 추출 및 이름 정리
df = df[['자치구별(2)', '0~4세', '5~9세', '10~14세', '15~19세', '20~24세', '25~29세', '30~34세',
         '35~39세', '40~44세', '45~49세', '50~54세', '55~59세', '60~64세', '65~69세',
         '70~74세', '75~79세', '80~84세', '85~89세', '90~94세', '95세 이상+']]
df.rename(columns={'자치구별(2)': '자치구'}, inplace=True)

# 3. 자치구 면적 정보
gu_area_km2 = {
    '종로구': 23.91, '중구': 9.96, '용산구': 21.87, '성동구': 16.82, '광진구': 17.06,
    '동대문구': 14.22, '중랑구': 18.5, '성북구': 24.58, '강북구': 23.6, '도봉구': 20.65,
    '노원구': 35.44, '은평구': 29.71, '서대문구': 17.63, '마포구': 23.85, '양천구': 17.41,
    '강서구': 41.45, '구로구': 20.12, '금천구': 13.02, '영등포구': 24.55, '동작구': 16.36,
    '관악구': 29.57, '서초구': 46.97, '강남구': 39.5, '송파구': 33.88, '강동구': 24.59
}
df['면적'] = df['자치구'].map(gu_area_km2)

# 4. 연령대 구간별 인구 합산
df['유소년인구'] = df[['0~4세', '5~9세', '10~14세', '15~19세']].sum(axis=1)
df['생산가능인구'] = df[['20~24세', '25~29세', '30~34세', '35~39세',
                    '40~44세', '45~49세', '50~54세', '55~59세']].sum(axis=1)
df['고령인구'] = df[['60~64세', '65~69세', '70~74세', '75~79세',
                '80~84세', '85~89세', '90~94세', '95세 이상+']].sum(axis=1)
df['총인구'] = df['유소년인구'] + df['생산가능인구'] + df['고령인구']

# 5. 인구밀도 계산
df['총인구밀도'] = (df['총인구'] / df['면적']).round(0).astype(int)
df['유소년인구밀도'] = (df['유소년인구'] / df['면적']).round(0).astype(int)
df['생산가능인구밀도'] = (df['생산가능인구'] / df['면적']).round(0).astype(int)
df['고령인구밀도'] = (df['고령인구'] / df['면적']).round(0).astype(int)

# 6. 원하는 열 정리
result = df[['자치구', '면적', '총인구밀도', '유소년인구밀도', '생산가능인구밀도', '고령인구밀도']]

# 7. 저장
result.to_csv("자치구기준_인구밀도.csv", index=False, encoding='utf-8-sig')